# NX-05 — Portal Issuer: дашборд и базовые отчёты с реальными данными

Цель: сделать дашборд и страницу `/reports` портала эмитента полезными для бизнеса: реальные данные о выпусках и базовая отчётность, синхронизированные с backend через API Gateway.

Контекст
- Общий контекст системы: `docs/context/PROJECT-CONTEXT.md`.
- Правила/качество: `docs/context/RULES-SUMMARY.md`, промпты BACKEND-OIS и BACKEND-BUILD-AND-TEST.
- Frontend статус/пробелы: `docs/context/FRONTEND-CONTEXT.md`, `artifacts/FRONTEND-FUNCTIONALITY-ANALYSIS.md`.

Скоуп (что должно быть по итогу)
- `/dashboard` показывает агрегированные метрики по активным/закрытым выпускам и базовые KPI.
- `/reports` предоставляет минимум 2 отчёта:
  - Отчёт по выпускам (кол-во, объёмы, статусы).
  - Отчёт по выплатам (если данные есть в backend; иначе — заглушка с TODO + SPEC DIFF).
- Данные загружаются через API Gateway по существующим или добавленным (через SPEC DIFF) эндпойнтам.

Шаги
1. **Уточнить контракты отчётов**
   - Изучить `docs/frontend/MVP-impl.md` секцию Issuer/Reports.
   - Проверить в `packages/contracts/openapi-gateway.yaml`, какие отчётные эндпойнты уже задекларированы.
   - Если отчётов нет или не хватает — подготовить SPEC DIFF (YAML-патч) и сохранить в `tasks/` как отдельный файл (например, `TASK-issuer-reports-SPEC-DIFF.md`).

2. **API-клиент и вызовы на фронте**
   - Проверить наличие и актуальность TS SDK (`packages/sdks/ts`); при необходимости сгенерировать/обновить.
   - В `apps/portal-issuer` реализовать функции получения данных для:
     - Сводки по выпускам для дашборда.
     - Списка выпусков и/или агрегированных показателей для отчётов.
   - Добавить в запросы заголовки наблюдаемости (`x-request-id`, `traceparent`, `x-client-app`), если это не делается централизованно.

3. **Реализация UI-для дашборда**
   - Используя имеющийся layout `/dashboard`, заменить заглушки на реальные данные.
   - Показать как минимум:
     - Кол-во активных выпусков / закрытых выпусков.
     - Общий объём эмиссий (сумма номиналов активных выпусков).
     - Кол-во инвесторов (если метрика доступна; иначе — TODO с описанием, какие данные нужны из backend).

4. **Реализация UI-для `/reports`**
   - Сделать список доступных отчётов (карточки или таблицу): "Отчёт по выпускам", "Отчёт по выплатам".
   - Для отчёта по выпускам:
     - Таблица с основными полями (ID выпуска, наименование, статус, объём, дата выпуска/закрытия).
     - Возможность выгрузки CSV/XLSX (если backend предоставляет; иначе — CSV на клиенте).
   - Для отчёта по выплатам (если данные есть): аналогичный список выплат с фильтрами по выпуску/дате.

5. **Интеграционные проверки и тесты**
   - Добавить/обновить компонентные тесты для ключевых компонентов дашборда/отчётов (если в проекте уже есть тестовый каркас).
   - Добавить/обновить e2e-сценарий для портала эмитента (Playwright), проходящий последовательность:
     - Логин (можно с заглушкой сессии).
     - Переход на `/dashboard` → проверка отображения метрик.
     - Переход на `/reports` → проверка, что отчёты загружаются и отображаются.

Команды
- Frontend dev:
  - `cd apps/portal-issuer`
  - `npm install`
  - `npm run dev`
- Backend (для проверки реальных данных): см. `BACKEND-BUILD-AND-TEST.md` и Makefile/скрипты в корне.
- E2E (если Playwright настроен): `npm run test:e2e` или аналогичная команда из `package.json`.

Артефакты
- Изменения в `apps/portal-issuer` (страницы `/dashboard`, `/reports`, сервисы данных/SDK).
- При необходимости: SPEC DIFF для отчётных эндпойнтов → отдельный `.md` в `tasks/`.
- `artifacts/issuer-dashboard-and-reports.md` — краткий отчёт с:
  - Использованными эндпойнтами и примерами ответов.
  - Скриншотами или описанием результатов E2E.

Критерии приёмки
- Дашборд `/dashboard` отображает реальные данные по выпускам (без заглушек) при запущенном backend.
- Страница `/reports` предоставляет как минимум один рабочий отчёт по выпускам с возможностью выгрузки данных.
- Все вызовы к API соответствуют спецификациям OpenAPI; расхождения задокументированы SPEC DIFF.
- Наличие описанного артефакта `artifacts/issuer-dashboard-and-reports.md`.

