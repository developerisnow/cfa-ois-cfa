# –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è GitLab Runner

**–î–∞—Ç–∞:** 2025-01-27  
**–í–æ–ø—Ä–æ—Å:** –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ª–∏ –∫–æ–º–∞–Ω–¥–∞ `gitlab-runner register` –ø—Ä–∏ –ø–æ–¥–Ω—è—Ç–∏–∏ –ø–æ–¥–∞?

---

## ‚ùå –ù–ï–¢, –∫–æ–º–∞–Ω–¥–∞ `register` –ù–ï –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

### –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ:

1. **–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø–æ–¥–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∫–æ–º–∞–Ω–¥–∞ `run`:**
   ```bash
   gitlab-runner run --config=/etc/gitlab-runner/config.toml
   ```

2. **GitLab Runner —á–∏—Ç–∞–µ—Ç config.toml –∏:**
   - –ï—Å–ª–∏ runner **—É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω** ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π **authentication token**
   - –ï—Å–ª–∏ runner **–ù–ï –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω** ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑—É—è **registration token** –∏–∑ config.toml

---

## üîç –î–í–ê –¢–ò–ü–ê –¢–û–ö–ï–ù–û–í

### 1. Registration Token (—Ç–æ–∫–µ–Ω —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏)
- **–§–æ—Ä–º–∞—Ç:** `GR1348941HYErDk_6wh8UsSenSgsU`
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:** –¢–æ–ª—å–∫–æ –¥–ª—è –ø–µ—Ä–≤–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ runner'–∞
- **–ì–¥–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è:** –í config.toml –∫–∞–∫ `token = "GR..."`
- **–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:** –ü–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ GitLab Runner –∑–∞–º–µ–Ω—è–µ—Ç registration token –Ω–∞ authentication token

### 2. Authentication Token (—Ç–æ–∫–µ–Ω –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏)
- **–§–æ—Ä–º–∞—Ç:** –û–±—ã—á–Ω–æ –¥–ª–∏–Ω–Ω–µ–µ, –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è GitLab
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:** –î–ª—è –≤—Å–µ—Ö –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- **–ì–¥–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è:** –í config.toml (–∑–∞–º–µ–Ω—è–µ—Ç registration token –ø–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏)
- **–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:** Runner –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —ç—Ç–æ—Ç —Ç–æ–∫–µ–Ω –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ GitLab

---

## üîÑ –ü–†–û–¶–ï–°–° –†–ï–ì–ò–°–¢–†–ê–¶–ò–ò

### –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ (runner –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω):

1. Pod –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Å –∫–æ–º–∞–Ω–¥–æ–π `run`
2. GitLab Runner —á–∏—Ç–∞–µ—Ç config.toml
3. –í–∏–¥–∏—Ç registration token (`GR...`)
4. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è** –≤ GitLab
5. GitLab –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç authentication token
6. GitLab Runner **—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç** authentication token –≤ config.toml (–≤ –ø–∞–º—è—Ç–∏ –∏–ª–∏ –Ω–∞ –¥–∏—Å–∫–µ)
7. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç authentication token –¥–ª—è –≤—Å–µ—Ö –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

### –ü–æ—Å–ª–µ–¥—É—é—â–∏–µ –∑–∞–ø—É—Å–∫–∏ (runner —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω):

1. Pod –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Å –∫–æ–º–∞–Ω–¥–æ–π `run`
2. GitLab Runner —á–∏—Ç–∞–µ—Ç config.toml
3. –í–∏–¥–∏—Ç authentication token (–Ω–µ registration token)
4. **–ò—Å–ø–æ–ª—å–∑—É–µ—Ç** authentication token –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ GitLab
5. **–ò–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç** registration token, –µ—Å–ª–∏ –æ–Ω –≤—Å–µ –µ—â–µ –≤ config.toml

---

## ‚ö†Ô∏è –ü–†–û–ë–õ–ï–ú–ê: Runner —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω

–ï—Å–ª–∏ runner —É–∂–µ –±—ã–ª –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω —Ä–∞–Ω–µ–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤—Ä—É—á–Ω—É—é –≤ –ø–æ–¥–µ), —Ç–æ:

- ‚úÖ Runner –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **—Å—Ç–∞—Ä—ã–π authentication token** (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π –≥–¥–µ-—Ç–æ)
- ‚ùå Runner **–∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç** registration token –∏–∑ ConfigMap
- ‚ùå –ï—Å–ª–∏ —Å—Ç–∞—Ä—ã–π authentication token –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω ‚Üí –ø–æ–ª—É—á–∞–µ–º 403 Forbidden

---

## üîß –†–ï–®–ï–ù–ò–ï: –ü–µ—Ä–µ—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è Runner

### –í–∞—Ä–∏–∞–Ω—Ç 1: –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—É—é —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –≤ GitLab UI

1. –û—Ç–∫—Ä—ã—Ç—å: https://git.telex.global/npk/ois-cfa/-/settings/ci_cd
2. –†–∞–∑–¥–µ–ª: Runners
3. –ù–∞–π—Ç–∏ runner —Å –ø—Ä–æ–±–ª–µ–º–æ–π (ID: `HYErDk_6w`)
4. –£–¥–∞–ª–∏—Ç—å –µ–≥–æ
5. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å pods:
   ```bash
   kubectl rollout restart deployment/gitlab-runner -n gitlab-runner
   ```
6. Runner –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è —Å –Ω–æ–≤—ã–º registration token –∏–∑ ConfigMap

### –í–∞—Ä–∏–∞–Ω—Ç 2: –û—á–∏—Å—Ç–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é

–ï—Å–ª–∏ runner —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –≤ PersistentVolume –∏–ª–∏ –¥—Ä—É–≥–æ–º –º–µ—Å—Ç–µ:

1. –ù–∞–π—Ç–∏, –≥–¥–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (–æ–±—ã—á–Ω–æ –≤ `/etc/gitlab-runner/.runner_system_id` –∏–ª–∏ –ø–æ–¥–æ–±–Ω–æ–º)
2. –£–¥–∞–ª–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å pods
4. Runner –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è –∑–∞–Ω–æ–≤–æ

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å initContainer –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

–ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å initContainer, –∫–æ—Ç–æ—Ä—ã–π —è–≤–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é:

```yaml
initContainers:
  - name: register-runner
    image: gitlab/gitlab-runner:latest
    command:
      - sh
      - -c
      - |
        gitlab-runner register \
          --non-interactive \
          --url https://git.telex.global/ \
          --registration-token ${RUNNER_TOKEN} \
          --executor kubernetes \
          --config /etc/gitlab-runner/config.toml
    volumeMounts:
      - name: config
        mountPath: /etc/gitlab-runner
```

–ù–æ —ç—Ç–æ –Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è, —Ç–∞–∫ –∫–∞–∫ GitLab Runner –¥–æ–ª–∂–µ–Ω —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

---

## ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–ê–Ø –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø

### –¢–µ–∫—É—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è):

```yaml
# deployment.yaml
args:
  - run
  - --config=/etc/gitlab-runner/config.toml
```

```toml
# config.toml
[[runners]]
  name = "ois-cfa-runner"
  url = "https://git.telex.global"
  token = "GR1348941HYErDk_6wh8UsSenSgsU"  # Registration token
  executor = "kubernetes"
```

**–≠—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ!** GitLab Runner –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ.

---

## üéØ –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–Ø

–ï—Å–ª–∏ runner –ø–æ–ª—É—á–∞–µ—Ç 403 Forbidden:

1. **–£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–π runner –∏–∑ GitLab UI** (–µ—Å–ª–∏ –æ–Ω —Ç–∞–º –µ—Å—Ç—å)
2. **–£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ registration token –∞–∫—Ç—É–∞–ª–µ–Ω** –≤ ConfigMap
3. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å pods:**
   ```bash
   kubectl delete pods -n gitlab-runner -l app=gitlab-runner
   ```
4. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏** - –¥–æ–ª–∂–µ–Ω –ø–æ—è–≤–∏—Ç—å—Å—è –ø—Ä–æ—Ü–µ—Å—Å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
5. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ GitLab UI** - –Ω–æ–≤—ã–π runner –¥–æ–ª–∂–µ–Ω –ø–æ—è–≤–∏—Ç—å—Å—è

---

## üìù –í–´–í–û–î

- ‚ùå –ö–æ–º–∞–Ω–¥–∞ `register` **–ù–ï –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- ‚úÖ –ö–æ–º–∞–Ω–¥–∞ `run` –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—É—Å–∫–µ –ø–æ–¥–∞
- ‚úÖ GitLab Runner **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è** –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ, –µ—Å–ª–∏ –≤–∏–¥–∏—Ç registration token
- ‚ö†Ô∏è –ï—Å–ª–∏ runner —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω, –æ–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π authentication token
- üîß –î–ª—è –ø–µ—Ä–µ—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω—É–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–π runner –∏–∑ GitLab UI

---

**–¢–µ–∫—É—â–∞—è –ø—Ä–æ–±–ª–µ–º–∞:** Runner —É–∂–µ –±—ã–ª –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω —Ä–∞–Ω–µ–µ, –ø–æ—ç—Ç–æ–º—É –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç registration token –∏–∑ ConfigMap. –†–µ—à–µ–Ω–∏–µ: —É–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–π runner –∏–∑ GitLab UI –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å pods.

