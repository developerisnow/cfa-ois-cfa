# GitLab Runner: Status Report

**–î–∞—Ç–∞:** 2025-01-27  
**–ü—Ä–æ–≤–µ—Ä–∫–∞:** –°–æ—Å—Ç–æ—è–Ω–∏–µ jobs –≤ GitLab –∏ runner pods

---

## ‚úÖ –ü–û–õ–û–ñ–ò–¢–ï–õ–¨–ù–û–ï

### 1. Runner Pods
- **–°—Ç–∞—Ç—É—Å:** 2/2 Running (1/1 Ready)
- **–í–æ–∑—Ä–∞—Å—Ç:** ~78 –º–∏–Ω—É—Ç
- **–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∏:** 0

### 2. ConfigMap
- **–ü—Ä–∏–º–µ–Ω–µ–Ω:** ‚úÖ
- **Concurrent builds:** 3 (—É–º–µ–Ω—å—à–µ–Ω–æ —Å 10)
- **Memory request:** 512Mi (—É–º–µ–Ω—å—à–µ–Ω–æ —Å 1Gi)
- **Memory limit:** 2Gi (—É–º–µ–Ω—å—à–µ–Ω–æ —Å 4Gi)
- **State file:** `/home/gitlab-runner/.runner_system_id` ‚úÖ

### 3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤
- **–ü–∞–º—è—Ç—å –Ω–æ–¥—ã:** 46% (–±—ã–ª–æ 92%)
- **CPU –Ω–æ–¥—ã:** 4%
- **–î–æ—Å—Ç—É–ø–Ω–∞—è –ø–∞–º—è—Ç—å:** –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è –Ω–æ–≤—ã—Ö jobs

### 4. –û—á–∏—Å—Ç–∫–∞
- **Pending pods:** –£–¥–∞–ª–µ–Ω—ã (—Å—Ç–∞—Ä—ã–µ —Å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º–∏ 1Gi)

---

## ‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´

### 1. 403 Forbidden (–ë–õ–û–ö–ï–†)

**–û—à–∏–±–∫–∞:**
```
ERROR: Checking for jobs... forbidden
status=POST https://git.telex.global/api/v4/jobs/request: 403 Forbidden
ERROR: Runner "https://git.telex.global__REPLACE" is unhealthy and will be disabled for 1h0m0s seconds!
```

**–ü—Ä–∏—á–∏–Ω–∞:**
- –¢–æ–∫–µ–Ω –≤ ConfigMap = `__REPLACE_WITH_RUNNER_TOKEN__` (placeholder)
- Runner –Ω–µ –º–æ–∂–µ—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å—Å—è –≤ GitLab

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- Runner –Ω–µ –º–æ–∂–µ—Ç –ø–æ–ª—É—á–∏—Ç—å jobs
- Runner –ø–æ–º–µ—á–µ–Ω –∫–∞–∫ unhealthy
- Jobs –Ω–µ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
```bash
export RUNNER_TOKEN="glrt-–≤–∞—à-—Ç–æ–∫–µ–Ω"
make gitlab-runner-fix-403
```

---

### 2. State File Warning (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ)

**–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –≤ –ª–æ–≥–∞—Ö:**
```
WARNING: Couldn't save new system ID on state file.
state_file=/etc/gitlab-runner/.runner_system_id
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:**
- –í ConfigMap —É–∫–∞–∑–∞–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø—É—Ç—å: `/home/gitlab-runner/.runner_system_id`
- –í pod config.toml —Ç–æ–∂–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø—É—Ç—å
- –í–æ–∑–º–æ–∂–Ω–æ, runner –µ—â–µ –Ω–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏–ª config –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫—ç—à

**–†–µ—à–µ–Ω–∏–µ:**
- –ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞ –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –¥–æ–ª–∂–Ω–æ –∏—Å—á–µ–∑–Ω—É—Ç—å
- –ï—Å–ª–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å volume mounts

---

## üìä –¢–ï–ö–£–©–ï–ï –°–û–°–¢–û–Ø–ù–ò–ï

### Kubernetes
- **Runner pods:** 2/2 Running
- **Job pods:** 0 (pending —É–¥–∞–ª–µ–Ω—ã)
- **Namespace:** gitlab-runner

### ConfigMap
- **Concurrent:** 3 ‚úÖ
- **Memory settings:** –£–º–µ–Ω—å—à–µ–Ω—ã ‚úÖ
- **State file:** –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø—É—Ç—å ‚úÖ
- **Token:** ‚ùå Placeholder (—Ç—Ä–µ–±—É–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è)

### GitLab
- **Runner status:** Unhealthy (–∏–∑-–∑–∞ 403)
- **Jobs:** –ù–µ –º–æ–≥—É—Ç –±—ã—Ç—å –ø–æ–ª—É—á–µ–Ω—ã

---

## üìã –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –î–ï–ô–°–¢–í–ò–Ø

### 1. –û–±–Ω–æ–≤–∏—Ç—å —Ç–æ–∫–µ–Ω (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û)

```bash
# –ü–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω –∏–∑ GitLab UI:
# https://git.telex.global/npk/ois-cfa/-/settings/ci_cd ‚Üí Runners

export RUNNER_TOKEN="glrt-–≤–∞—à-—Ç–æ–∫–µ–Ω"
make gitlab-runner-fix-403
```

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ (–Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 403)
kubectl logs -n gitlab-runner -l app=gitlab-runner --tail=20 | grep -i "403\|forbidden"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–æ–∫–µ–Ω –≤ ConfigMap
kubectl get configmap -n gitlab-runner gitlab-runner-config -o jsonpath='{.data.config\.toml}' | grep token
```

### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ GitLab UI

1. –û—Ç–∫—Ä–æ–π—Ç–µ: https://git.telex.global/npk/ois-cfa/-/settings/ci_cd
2. –†–∞–∑–¥–µ–ª: Runners
3. Runner –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å **Online** (–Ω–µ unhealthy)
4. Jobs –¥–æ–ª–∂–Ω—ã –∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è

---

## üìö –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–ê–Ø –ò–ù–§–û–†–ú–ê–¶–ò–Ø

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã
- ‚úÖ –£–º–µ–Ω—å—à–µ–Ω—ã —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –ø–∞–º—è—Ç–∏ (47% —ç–∫–æ–Ω–æ–º–∏–∏)
- ‚úÖ –£–º–µ–Ω—å—à–µ–Ω–æ concurrent builds (10 ‚Üí 3)
- ‚úÖ Health checks –æ—Ç–∫–ª—é—á–µ–Ω—ã
- ‚úÖ State file –ø—É—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω

### –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞
- ‚úÖ –ù–µ—Ç –æ—à–∏–±–æ–∫ 403 –≤ –ª–æ–≥–∞—Ö
- ‚úÖ Runner –ø–æ–ª—É—á–∞–µ—Ç jobs
- ‚úÖ Jobs –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è —Å —É–º–µ–Ω—å—à–µ–Ω–Ω—ã–º–∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º–∏ –ø–∞–º—è—Ç–∏
- ‚úÖ –ù–µ—Ç –ø—Ä–æ–±–ª–µ–º —Å –ø–∞–º—è—Ç—å—é

---

**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç—Å—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã runner'–∞

