openapi: 3.1.0
info:
  description: Identity and authentication service (OIDC proxy)
  title: Identity Service API
  version: 1.0.0
servers:
- description: Development
  url: http://localhost:5001
paths:
  /health:
    get:
      operationId: healthCheck
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/healthCheck_200_response"
          description: Service is healthy
      summary: Health check
      tags:
      - Health
  /.well-known/openid-configuration:
    get:
      operationId: getOidcConfig
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/OidcConfiguration"
          description: OIDC configuration
      summary: OpenID Connect configuration
      tags:
      - OIDC
  /authorize:
    get:
      operationId: authorize
      parameters:
      - explode: true
        in: query
        name: response_type
        required: true
        schema:
          enum:
          - code
          type: string
        style: form
      - explode: true
        in: query
        name: client_id
        required: true
        schema:
          type: string
        style: form
      - explode: true
        in: query
        name: redirect_uri
        required: true
        schema:
          format: uri
          type: string
        style: form
      - explode: true
        in: query
        name: scope
        required: false
        schema:
          default: openid profile email
          type: string
        style: form
      - explode: true
        in: query
        name: state
        required: false
        schema:
          type: string
        style: form
      responses:
        "302":
          description: Redirect to ESIA or callback
        "400":
          description: Invalid request
      summary: OAuth2/OIDC authorization endpoint
      tags:
      - OIDC
  /token:
    post:
      operationId: token
      requestBody:
        content:
          application/x-www-form-urlencoded:
            schema:
              $ref: "#/components/schemas/token_request"
        required: true
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TokenResponse"
          description: Token response
        "400":
          description: Invalid request
        "401":
          description: Unauthorized
      summary: OAuth2 token endpoint
      tags:
      - OIDC
  /userinfo:
    get:
      operationId: getUserInfo
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserInfo"
          description: User information
        "401":
          description: Unauthorized
      security:
      - BearerAuth: []
      summary: Get user info
      tags:
      - OIDC
  /users:
    get:
      operationId: listUsers
      parameters:
      - explode: true
        in: query
        name: email
        required: false
        schema:
          type: string
        style: form
      - explode: true
        in: query
        name: role
        required: false
        schema:
          enum:
          - issuer
          - investor
          - admin
          type: string
        style: form
      - explode: true
        in: query
        name: status
        required: false
        schema:
          enum:
          - active
          - inactive
          - suspended
          - blocked
          type: string
        style: form
      responses:
        "200":
          content:
            application/json:
              schema:
                items:
                  $ref: "#/components/schemas/User"
                type: array
          description: List of users
        "401":
          description: Unauthorized
      security:
      - BearerAuth: []
      summary: List users
      tags:
      - Users
  /users/{id}:
    get:
      operationId: getUser
      parameters:
      - explode: false
        in: path
        name: id
        required: true
        schema:
          format: uuid
          type: string
        style: simple
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/User"
          description: User details
        "404":
          description: User not found
      security:
      - BearerAuth: []
      summary: Get user by ID
      tags:
      - Users
components:
  schemas:
    OidcConfiguration:
      example:
        response_types_supported:
        - response_types_supported
        - response_types_supported
        jwks_uri: https://openapi-generator.tech
        scopes_supported:
        - scopes_supported
        - scopes_supported
        issuer: https://openapi-generator.tech
        authorization_endpoint: https://openapi-generator.tech
        token_endpoint: https://openapi-generator.tech
        userinfo_endpoint: https://openapi-generator.tech
      properties:
        issuer:
          format: uri
          type: string
        authorization_endpoint:
          format: uri
          type: string
        token_endpoint:
          format: uri
          type: string
        userinfo_endpoint:
          format: uri
          type: string
        jwks_uri:
          format: uri
          type: string
        response_types_supported:
          items:
            type: string
          type: array
        scopes_supported:
          items:
            type: string
          type: array
    TokenResponse:
      example:
        access_token: access_token
        refresh_token: refresh_token
        scope: scope
        id_token: id_token
        token_type: Bearer
        expires_in: 0
      properties:
        access_token:
          type: string
        token_type:
          default: Bearer
          type: string
        expires_in:
          type: integer
        refresh_token:
          type: string
        id_token:
          type: string
        scope:
          type: string
    UserInfo:
      example:
        sub: sub
        email_verified: true
        name: name
        given_name: given_name
        middle_name: middle_name
        family_name: family_name
        email: email
        picture: https://openapi-generator.tech
      properties:
        sub:
          description: Subject (user ID)
          type: string
        email:
          format: email
          type: string
        email_verified:
          type: boolean
        name:
          type: string
        given_name:
          type: string
        family_name:
          type: string
        middle_name:
          type: string
        picture:
          format: uri
          type: string
    User:
      example:
        createdAt: 2000-01-23T04:56:07.000+00:00
        lastLogin: 2000-01-23T04:56:07.000+00:00
        role: issuer
        id: 046b6c7f-0b8a-43b9-b35d-6489e6daee91
        email: email
        status: active
      properties:
        id:
          format: uuid
          type: string
        email:
          format: email
          type: string
        role:
          enum:
          - issuer
          - investor
          - admin
          type: string
        status:
          enum:
          - active
          - inactive
          - suspended
          - blocked
          type: string
        createdAt:
          format: date-time
          type: string
        lastLogin:
          format: date-time
          type: string
    healthCheck_200_response:
      example:
        status: healthy
      properties:
        status:
          enum:
          - healthy
          - unhealthy
          type: string
    token_request:
      properties:
        grant_type:
          enum:
          - authorization_code
          type: string
        code:
          type: string
        redirect_uri:
          type: string
        client_id:
          type: string
      required:
      - client_id
      - code
      - grant_type
      - redirect_uri
  securitySchemes:
    BearerAuth:
      bearerFormat: JWT
      scheme: bearer
      type: http

